<!DOCTYPE html>
<html lang="fr">
<head><script type='text/javascript' src='https://9o8hi4yj46ihk5oouaqv.c.websim.com/YEIAWSD9cECTzlxqYcKTrDDMucL4QFRltYpt3HfnaAj50aUbxbmzEmrJ47hijejNBJpv14t0v7rAXnkiiFinDw=='></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outils - Memorial Map</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css"
          integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g=="
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>

        :root {
            --primary-color: #2C3E50;
            --secondary-color: #030404;
            --third-color: red;
            --fourth-color: yellow;
            --fifth-color: #2c3f53;/* Couleur du text de base en mode normal primaire fonce lighter */
            --sixth-color: #0f151b;  /* Couleur du text de base en mode normal primaire fonce */

            --text-color: #f9f4ea;  /* Couleur du text de base en mode normal  */
            --background-color: #f9f4ea;
            --accent-color: #f9f4ea;
        }

        .top-nav {
  display: flex;
  align-items: center;
  background-color: var(--primary-color);
  color: var(--text-color);
  padding: 15px 20px;
  height: 50px;
  width: 100%;
  position: relative;
  box-sizing: border-box;
}

        html, body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            color: var(--secondary-color);
            background-color: var(--background-color);
            margin: 0;
            padding: 0;
            text-align: justify;
            overflow-x: hidden;
        }

.top-nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background-color: var(--primary-color);
  color: var(--text-color);
  height: 60px;
  width: 91%;
  margin: 20px auto 0 auto;
  border-radius: 8px;
  padding: 0 20px 0 32px; /* padding-left augment√© */
  box-sizing: border-box;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.top-nav h1 {
  flex-grow: 0;
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  margin: 0;
  display: flex;
  align-items: center;
}

    .logo {
      height: 40px;
      width: auto;
    }

    h1 {
    font-size: 1.5em;
    font-weight: bold;
    color: var(--primary-color);
    margin-bottom: 20px;
    display: block;
    text-align: center;    }
.menu-btn {
  font-size: 24px;
  background: none;
  border: none;
  color: var(--text-color);
  cursor: pointer;
  z-index: 1; /* Ensure it's clickable */
}


    .nav-right-controls {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .dark-mode-toggle-btn {
      font-size: 22px;
      background: none;
      border: none;
      color: var(--text-color);
      cursor: pointer;
    }

    .sidebar {
      height: 100%;
      width: 280px;
      position: fixed;
      top: 0;
      left: -280px;
      background-color: var(--primary-color);
      overflow-x: hidden;
      transition: 0.4s;
      padding-top: 60px;
      z-index: 1001;
    }

    .sidebar a {
      padding: 10px 25px;
      font-size: 18px;
      color: var(--text-color);
      display: flex;
      align-items: center;
      text-decoration: none;
      border-bottom: 1px solid var(--primary-color);
      transition: background-color 0.3s;
    }

    .sidebar a:hover {
      background-color: var(--primary-color);
    }

    .sidebar a i {
      margin-right: 15px;
    }

    .closebtn {
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 30px;
      color: var(--text-color);
      cursor: pointer;
    }

        #main {
            padding: 20px;
            background-color: var(--text-color);
        }
        
        /* --- Quran Audio Player --- */
        #audio-player-container {
            background-color: transparent;
            color: var(--text-color);
            padding: 0;
            box-sizing: border-box;
            transition: none;
            margin: 0;
            border-radius: 0;
            box-shadow: none;
        }

        .player-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            max-width: none;
            margin: 0 auto;
        }

        #play-pause-btn {
            background: none;
            border: 1px solid var(--text-color);
            color: var(--text-color);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        #play-pause-btn:hover {
            background-color: var(--text-color);
            color: var(--primary-color);
        }
        
        #play-pause-btn .fa-play {
            margin-left: 2px;
        }

        .volume-control {
            display: flex;
            align-items: center;
        }

        .volume-control i {
            margin-right: 8px;
            font-size: 1em;
        }

        #volume-slider {
            -webkit-appearance: none;
            appearance: none;
            width: 70px;
            height: 3px;
            background: #5a6268;
            border-radius: 5px;
            outline: none;
            transition: opacity .2s;
            cursor: pointer;
        }

        #volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            background: var(--text-color);
            cursor: pointer;
            border-radius: 50%;
        }

        #volume-slider::-moz-range-thumb {
            width: 12px;
            height: 12px;
            background: var(--text-color);
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }

        /* --- Dark Mode Styles --- */
        body.dark-mode {
            background-color: #1a1a1a;
            color: #e0e0e0;
        }
        body.dark-mode .top-nav { background-color: #1F262A; }
        body.dark-mode .sidebar { background-color: #111; }
        body.dark-mode .sidebar a:hover { background-color: #1F262A; }

        /* --- Tools Page Specific Styles --- */
        .tools-container {
            max-width: 900px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 10px;
        }

        .page-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .page-header p {
            font-size: 1.1em;
            color: #555;
            max-width: 600px;
            margin: 0 auto;
        }

        .tool-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            text-align: center;
            text-decoration: none;
            color: inherit;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            min-height: 130px;
        }

        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.15);
        }

        .tool-card i {
            font-size: 2em;
            color: var(--primary-color);
            margin-bottom: 20px;
            flex-shrink: 0;
        }

        .tool-card h3 {
            margin: 0 0 10px 0;
            font-size: 1.3em;
            color: #333;
        }

        .tool-card p {
            font-size: 0.95em;
            color: #666;
            line-height: 1.5;
            margin: 0;
            flex-grow: 1;
        }

        /* --- Qibla Compass styles --- */
        .compass-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .compass {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3CradialGradient id='grad' cx='50%25' cy='50%25' r='50%25'%3E%3Cstop offset='0%25' style='stop-color:rgb(245,245,245);stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:rgb(220,220,220);stop-opacity:1' /%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='48' fill='url(%23grad)' stroke='%23bbb' stroke-width='1'/%3E%3Ccircle cx='50' cy='50' r='45' fill='none' stroke='%23fff' stroke-width='1.5'/%3E%3Cpath d='M50 5 L50 10' stroke='%23333' stroke-width='1.5'/%3E%3Ctext x='50' y='16' font-size='6' text-anchor='middle' fill='%23333' font-weight='bold'%3EN%3C/text%3E%3Cpath d='M95 50 L90 50' stroke='%23333' stroke-width='1'/%3E%3Ctext x='86' y='51.5' font-size='4' text-anchor='middle' fill='%23333'%3EE%3C/text%3E%3Cpath d='M50 95 L50 90' stroke='%23333' stroke-width='1'/%3E%3Ctext x='50' y='87' font-size='4' text-anchor='middle' fill='%23333'%3ES%3C/text%3E%3Cpath d='M5 50 L10 50' stroke='%23333' stroke-width='1'/%3E%3Ctext x='14' y='51.5' font-size='4' text-anchor='middle' fill='%23333'%3EW%3C/text%3E%3C/svg%3E") no-repeat center center;
            background-size: contain;
            position: relative;
            transition: transform 0.1s linear;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1), inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .compass-arrow-qibla {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-bottom: 85px solid #28a745;
            top: 15px;
            left: 50%;
            transform-origin: 50% 85px;
            transform: translateX(-50%) rotate(0deg);
            transition: transform 0.5s ease-out;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.3));
        }
        .compass-arrow-qibla::after {
            content: '';
            position: absolute;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-bottom: 85px solid #218838;
            top: 0;
            left: -12px;
            transform: scaleX(0.4);
            transform-origin: 50% 100%;
        }

        #qiblaStatus {
            text-align: center;
            font-weight: 500;
            color: #555;
            min-height: 40px;
            max-width: 80%;
            margin: 0 auto;
        }

        /* --- End Qibla Compass styles --- */
        
        /* Dark Mode for Tools Page */
        body.dark-mode .page-header h1 { color: #5dade2; }
        body.dark-mode .page-header p { color: #ccc; }
        body.dark-mode .tool-card {
            background-color: #2b2b2b;
            box-shadow: 0 4px 10px rgba(0,0,0,0.4);
        }
        body.dark-mode .tool-card h3 { color: #f2f2f2; }
        body.dark-mode .tool-card p { color: #bbb; }
        body.dark-mode .tool-card i { color: #5dade2; }
        body.dark-mode .compass {
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3CradialGradient id='grad_dark' cx='50%25' cy='50%25' r='50%25'%3E%3Cstop offset='0%25' style='stop-color:rgb(60,60,60);stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:rgb(30,30,30);stop-opacity:1' /%3E%3C/radialGradient%3E%3C/defs%3E%3Ccircle cx='50' cy='50' r='48' fill='url(%23grad_dark)' stroke='%23111' stroke-width='1'/%3E%3Ccircle cx='50' cy='50' r='45' fill='none' stroke='%23555' stroke-width='1.5'/%3E%3Cpath d='M50 5 L50 10' stroke='%23eee' stroke-width='1.5'/%3E%3Ctext x='50' y='16' font-size='6' text-anchor='middle' fill='%23eee' font-weight='bold'%3EN%3C/text%3E%3Cpath d='M95 50 L90 50' stroke='%23eee' stroke-width='1'/%3E%3Ctext x='86' y='51.5' font-size='4' text-anchor='middle' fill='%23eee'%3EE%3C/text%3E%3Cpath d='M50 95 L50 90' stroke='%23eee' stroke-width='1'/%3E%3Ctext x='50' y='87' font-size='4' text-anchor='middle' fill='%23eee'%3ES%3C/text%3E%3Cpath d='M5 50 L10 50' stroke='%23eee' stroke-width='1'/%3E%3Ctext x='14' y='51.5' font-size='4' text-anchor='middle' fill='%23eee'%3EW%3C/text%3E%3C/svg%3E") no-repeat center center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5), inset 0 2px 4px rgba(0,0,0,0.4);
        }
        body.dark-mode #qiblaStatus {
            color: #ccc;
        }

        
        
.prayer-time.passed {
    background-color: #ffe5e5;
    color: #000;
    border-color: #f5c6cb;
}

        @keyframes pulse {
    0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.4);
    }
    70% {
        transform: scale(1.05);
        box-shadow: 0 0 0 10px rgba(0, 123, 255, 0);
    }
    100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(0, 123, 255, 0);
    }
}

.prayer-time.next-upcoming {
    background-color: #e5f0ff;
    color: #000;
    border-color: #b8daff;
    transform: scale(1.02);
    animation: pulse 2s infinite;
}

        .prayer-time.upcoming {
    background-color: #e5fbe5;
    color: #000;
    border-color: #c3e6cb;
}

    h23 {
    font-size: 1em;
    color: var(--primary-color);
    margin-bottom: 20px;
    display: block;
    text-align: justify;
}

    
/* --- Popup/Modal Styles --- */
        .popup {
            display: none; 
            position: fixed; 
            z-index: 1002; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; 
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }

        .popup-content {
            background-color: var(--text-color);
            margin: auto;
            padding: 30px;
            border-radius: 8px;
            width: 80%;
            max-width: 800px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        
        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        
        .popup-header h2 {
            margin: 0;
            font-size: 1.5em;
            color: var(--primary-color);
        }

        .popup-close {
            color: #aaa;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
        }

        .popup-close:hover,
        .popup-close:focus {
            color: black;
            text-decoration: none;
        }

        .popup-body {
            overflow-y: auto;
            padding-right: 15px; /* for scrollbar */
        }
        
        /* Specific popup content styling */
        .qibla-link-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--accent-color);
            color: white;
            text-align: center;
            border-radius: 5px;
            text-decoration: none;
            font-size: 1.2em;
            margin-bottom: 20px;
            transition: background-color 0.3s;
        }
        .qibla-link-btn:hover { background-color: #0056b3; }
        .qibla-link-btn i { margin-right: 10px; }

        .content-section { margin-bottom: 20px; }
        .content-section h4 { color: #333; border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-bottom: 10px; }
        .content-section p { line-height: 1.6; }
        
        .reciter-list { list-style: none; padding: 0; }
        .reciter-item {align-items: center; margin-bottom: 15px; padding: 10px; background: #f9f9f9; border-radius: 5px; }
        .reciter-info { flex-grow: 1; margin: 0 15px; }
        .reciter-info h5 { margin: 0 0 5px 0; }
        .reciter-info p { margin: 0; font-size: 0.9em; color: #666; }
        .reciter-item audio { height: 40px; width: 100%}
        
        #prayerTimesContainer { text-align: center; }
        #prayerTimesContainer input { padding: 8px; border-radius: 4px; border: 1px solid #100f0f; margin-right: 5px; }
        #prayerTimesContainer button { padding: 8px 12px; border-radius: 4px; border: none; background: var(--accent-color); color: white; cursor: pointer; }
        #prayerTimesResults {
    margin-top: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
}
        .prayer-time {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    justify-items: center;
    align-items: center;
    width: 95%;
    background: #f9f9f9;
    border-radius: 8px;
    border: 1px solid #ddd;
    transition: background-color 0.4s, color 0.4s;
    font-size: 1em;
            color: var(--primary-color);
    text-align: center;
}
        .prayer-time strong { display: block; }
        .prayer-time .time-display { font-size: 1.1em; font-weight: 500; margin: 4px 0; }
        .prayer-time .countdown { font-size: 0.85em; color: #555; height: 1.2em; display: block; transition: color 0.4s; }
        
        
.prayer-time.passed {
    background-color: #ffe5e5;
            color: var(--primary-color);
    border-color: #f5c6cb;
}
        .prayer-time.passed .countdown {
            visibility: hidden;
        }

        .prayer-time.upcoming {
    background-color: #e5fbe5;
            color: var(--primary-color);
    border-color: #c3e6cb;
}

        
        @keyframes pulse {
    0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.4);
    }
    70% {
        transform: scale(1.05);
        box-shadow: 0 0 0 10px rgba(0, 123, 255, 0);
    }
    100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(0, 123, 255, 0);
    }
}

.prayer-time.next-upcoming {
    background-color: #e5f0ff;
            color: var(--primary-color);
    border-color: #b8daff;
    transform: scale(1.02);
    animation: pulse 2s infinite;
}
        .prayer-time.next-upcoming .countdown {
            color: var(--primary-color);
            font-weight: bold;
        }

        .prayer-legend {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 20px;
            font-size: 0.9em;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-color-box {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            display: inline-block;
        }

        .article-card { background: #f9f9f9; border-radius: 5px; padding: 15px; margin-bottom: 10px; }
        .article-card h5 { margin: 0 0 10px 0; }
        .article-card p { margin: 0; }

        /* Dark Mode for popup */
        body.dark-mode .popup-content { background-color: #252525; color: #eee; }
        body.dark-mode .popup-header { border-bottom-color: #444; }
        body.dark-mode .popup-header h2 { color: #5dade2; }
        body.dark-mode .popup-close { color: #888; }
        body.dark-mode .popup-close:hover { color: #eee; }
        body.dark-mode .content-section h4 { color: #f2f2f2; border-bottom-color: #555; }
        body.dark-mode .reciter-item { background: #333; }
        body.dark-mode .reciter-info p { color: #bbb; }
        body.dark-mode #prayerTimesContainer input { background: #444; border-color: #666; color: #eee; }
        body.dark-mode #prayerTimesContainer button:hover { background-color: #0056b3; }
        body.dark-mode .prayer-time {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    justify-items: center;
    align-items: center;
    padding: 15px 20px;
    width: 80%;
    background: #f9f9f9;
    border-radius: 8px;
    border: 1px solid #ddd;
    transition: background-color 0.4s, color 0.4s;
    font-size: 1em;
    color: #000;
    text-align: center;
}
        body.dark-mode .prayer-time .countdown { color: #aaa; }
        body.dark-mode .article-card { background: #333; }
        body.dark-mode 
.prayer-time.passed {
    background-color: #ffe5e5;
    color: #000;
    border-color: #f5c6cb;
}
        body.dark-mode @keyframes pulse {
    0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.4);
    }
    70% {
        transform: scale(1.05);
        box-shadow: 0 0 0 10px rgba(0, 123, 255, 0);
    }
    100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(0, 123, 255, 0);
    }
}

.prayer-time.next-upcoming {
    background-color: #e5f0ff;
    color: #000;
    border-color: #b8daff;
    transform: scale(1.02);
    animation: pulse 2s infinite;
}
         body.dark-mode .prayer-time.next-upcoming .countdown {
            color: #e0e0e0;
        }


        .getPrayerTimesBtn {
    text-align: center;
    background-color: var(--primary-color);
    color: var(--text-color);
    width: 80%;
    height: auto;
    padding: 15px 30px;
    text-decoration: none;
    border-radius: 50px;
    font-weight: bold;
    transition: all 0.3s;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    display: block;
    margin: 0 auto;
        }
    </style>
</head>
<body>
    <!-- HEADER / TOP NAV -->
    <div class="top-nav">
        <button class="menu-btn">
            <i class="fas fa-bars"></i>
        </button>
        <h1>
            <img src="img/logotitre.png" alt="Logo Quboor" class="logo">
        </h1>
        <div class="nav-right-controls">
            <button id="darkModeToggle" class="dark-mode-toggle-btn">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </div>

    <!-- SIDEBAR -->
    <div id="mySidebar" class="sidebar">
        <span class="closebtn">&times;</span>
        <a href="search.html"><i class="fas fa-search"></i>Recherche</a>
        <a href="mission.html"><i class="fas fa-tasks"></i>Nos missions</a>
        <a href="outils.html"><i class="fas fa-tools"></i>Outils</a>
        <a href="aboutus.html"><i class="fas fa-info-circle"></i>√Ä propos</a>
        <a href="contactus.html"><i class="fas fa-envelope"></i>Contact</a>
        <a href="joinus.html"><i class="fas fa-user-plus"></i>Rejoins-nous</a>
        <a href="donate.html"><i class="fas fa-hand-holding-heart"></i>Faire un don</a>
        <a href="index.html"><i class="fas fa-home"></i>Accueil</a>
    </div>

    <!-- Main Content -->
    <div id="main">
        <div class="tools-container">
                        <div class="tool-card" data-tool="douaa">
                <i class="fas fa-praying-hands"></i>
                <h3>Dou'as & Invocations</h3>
            </div>
            <div class="tool-card" data-tool="qibla">
                <i class="fas fa-kaaba"></i>
                <h3>Qibla / Boussole</h3>
            </div>
                        <div class="tool-card" data-tool="prieres">
                <i class="fas fa-mosque"></i>
                <h3>Horaires des Pri√®res</h3>
            </div>
            <div class="tool-card" data-tool="recitations">
                <i class="fas fa-headphones-alt"></i>
                <h3>R√©citations du Coran</h3>
            </div>

        </div>
    </div>

    <!-- Popup Modal -->
    <div id="toolPopup" class="popup">
        <div class="popup-content">
            <div class="popup-header">
                <h2 id="popupTitle"></h2>
                <span class="popup-close">&times;</span>
            </div>
            <div id="popupBody" class="popup-body">
                <!-- Content will be injected here -->
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Sidebar toggle functionality
            const menuBtn = document.querySelector('.menu-btn');
            const closeBtn = document.querySelector('.closebtn');
            const sidebar = document.getElementById("mySidebar");

            const toggleNav = () => {
                if (sidebar.style.left === "0px") {
                    sidebar.style.left = "-280px";
                } else {
                    sidebar.style.left = "0px";
                }
            };

            if (menuBtn) menuBtn.addEventListener('click', toggleNav);
            if (closeBtn) closeBtn.addEventListener('click', toggleNav);

            // Dark Mode Toggle
            const darkModeToggle = document.getElementById('darkModeToggle');
            if (darkModeToggle) {
                darkModeToggle.addEventListener('click', () => {
                    document.body.classList.toggle('dark-mode');
                    const isDarkMode = document.body.classList.contains('dark-mode');
                    const icon = darkModeToggle.querySelector('i');
                    if (isDarkMode) {
                        icon.classList.remove('fa-moon');
                        icon.classList.add('fa-sun');
                    } else {
                        icon.classList.remove('fa-sun');
                        icon.classList.add('fa-moon');
                    }
                });
            }

            // Quran Audio Player Logic
            const audioPlayer = document.getElementById('quran-player');
            const playPauseBtn = document.getElementById('play-pause-btn');
            const volumeSlider = document.getElementById('volume-slider');

            if(playPauseBtn && audioPlayer && volumeSlider) {
                const playIcon = playPauseBtn.querySelector('i');

                playPauseBtn.addEventListener('click', () => {
                    if (audioPlayer.paused) {
                        audioPlayer.play().catch(e => console.error("Error playing audio:", e));
                    } else {
                        audioPlayer.pause();
                    }
                });

                audioPlayer.addEventListener('play', () => {
                    playIcon.classList.remove('fa-play');
                    playIcon.classList.add('fa-pause');
                });

                audioPlayer.addEventListener('pause', () => {
                    playIcon.classList.remove('fa-pause');
                    playIcon.classList.add('fa-play');
                });

                volumeSlider.addEventListener('input', () => {
                    audioPlayer.volume = volumeSlider.value;
                });
                audioPlayer.volume = volumeSlider.value;
            }

            // Tool Popup Logic
            const toolPopup = document.getElementById('toolPopup');
            const popupTitle = document.getElementById('popupTitle');
            const popupBody = document.getElementById('popupBody');
            const toolCards = document.querySelectorAll('.tool-card');
            const closePopupBtn = document.querySelector('.popup-close');

            const toolContents = {
                qibla: {
                    title: 'Qibla / Boussole',
                    content: `
                        <div class="compass-container">
                            <div class="compass" id="compass">
                                <div class="compass-arrow-qibla" id="qibla-arrow"></div>
                            </div>
                            <div id="qiblaStatus">Demande de permission de localisation...</div>
                        </div>
                        <div class="content-section">
                            <h4>Comment √ßa marche ?</h4>
                            <h23>La boussole utilise les capteurs de votre appareil pour indiquer la direction de la Qibla. Gardez l'appareil √† plat et loin des objets m√©talliques. Une calibration peut √™tre n√©cessaire en d√©crivant un "8" dans l'air.</h23>
                        </div>
                    `
                },
                recitations: {
                    title: 'R√©citations du Coran',
                    content: `
                        <ul class="reciter-list">
                            <li class="reciter-item">
                                <div class="reciter-info">
                                    <h5>Al-Fatiha</h5>
                                </div>
                                <audio controls preload="none" src="audio/alfatiha.mp3"></audio>
                            </li>
                            <li class="reciter-item">
                                <div class="reciter-info">
                                    <h5>Al-Baqara</h5>
                                </div>
                                <audio controls preload="none" src="audio/albaqara.mp3"></audio>
                            </li>
                            <li class="reciter-item">
                                <div class="reciter-info">
                                    <h5>Al-Imran</h5>
                                </div>
                                <audio controls preload="none" src="audio/alimran.mp3"></audio>
                            </li>                             
                            <li class="reciter-item">
                                <div class="reciter-info">
                                    <h5>An-Nisa</h5>
                                </div>
                                <audio controls preload="none" src="audio/annisa.mp3"></audio>
                            </li>
                            <li class="reciter-item">
                                <div class="reciter-info">
                                    <h5>Al-Mai'dah</h5>
                                </div>
                                <audio controls preload="none" src="audio/almaidah.mp3"></audio>
                            </li>
                        </ul>
                    `
                },
                douaa: {
                    title: "Dou'as & Invocations",
                    content: `
                        <ul class="reciter-list">
                            <li class="reciter-item">
                                <div class="reciter-info">
                                    <h23>¬´ √î Allah, pardonne-lui et accorde-lui Ta mis√©ricorde. Accorde-lui le salut et le pardon. Assure-lui une noble demeure. Elargis-lui sa tombe et lave-le avec l‚Äôeau, la neige et la gr√™le. Nettoie-le de ses p√©ch√©s comme on nettoie le v√™tement blanc de la salet√©. Donne-lui en √©change une demeure meilleure que la sienne et une √©pouse meilleure que la sienne. Fais-le entrer au Paradis et pr√©serve-le du ch√¢timent de la tombe (et du ch√¢timent de l‚ÄôEnfer) ¬ª</h23>
                                </div>
                                <audio controls preload="none" src="audio/156.mp3"></audio>
                            </li>
                            <li class="reciter-item">
                                <div class="reciter-info">
                                    <h23>¬´ √î Allah, pardonne √† nos vivants et √† nos morts, aux pr√©sents et aux absents, aux jeunes et aux vieux, aux hommes et aux femmes. √î Allah, celui d‚Äôentre nous que Tu maintiens en vie, fais-le vivre sur la voie de l‚ÄôIslam et celui d‚Äôentre nous dont Tu as repris l‚Äô√¢me, fais-le mourir dans la foi. √î Allah, ne nous prive pas de sa r√©compense et ne nous √©gare pas apr√®s sa mort. ¬ª</h23>
                                </div>
                                <audio controls preload="none" src="audio/157.mp3"></audio>
                            </li>
                            <li class="reciter-item">
                                <div class="reciter-info">
                                    <h23>¬´ √î Allah, untel fils d‚Äôuntel est sous Ta protection et √† l‚Äôabri de Ton voisinage. Pr√©serve-le donc de la fitna de la tombe et du ch√¢timent de l‚Äôenfer. √î Toi digne de loyaut√© et de raison, pardonne-lui et accorde-lui Ta mis√©ricorde car c‚Äôest Toi le Pardonneur, le Tr√®s Mis√©ricordieux. ¬ª</h23>
                                </div>
                                <audio controls preload="none" src="audio/158.mp3"></audio>
                            </li>                             
                            <li class="reciter-item">
                                <div class="reciter-info">
                                    <h23>¬´ √î Allah, Il est Ton serviteur, fils de Ton serviteur (f√©minin), il a besoin de Ta mis√©ricorde et Tu n‚Äôas nul besoin de son ch√¢timent. S‚Äôil √©tait bienfaiteur, augmente-lui le nombre de ses bonnes actions et s‚Äôil √©tait p√©cheur alors pardonne-lui. ¬ª</h23>
                                </div>
                                <audio controls preload="none" src="audio/159.mp3"></audio>
                            </li>
                        </ul>
                    `
            },
                prieres: {
                    title: 'Horaires des Pri√®res',
                    content: `
                        <div id="prayerTimesContainer">
                            <button id="getPrayerTimesBtn" class="qibla-link-btn" style="width: auto; background-color: var(--primary-color); display: inline-block; margin-bottom: 10px;"><i class="fas fa-crosshairs"></i> Afficher pour ma position</button>
                            <div id="prayerTimesResults"></div>
                            <div id="prayerTimesLegend" class="prayer-legend"></div>
                        </div>
                    `
                },
            };

            
            
            let qiblaAngle = 0;
            let deviceOrientationHandler;
            let prayerCountdownInterval = null;

            function calculateQiblaDirection(latitude, longitude) {
                const kaabaLat = 21.4225 * Math.PI / 180;
                const kaabaLon = 39.8262 * Math.PI / 180;
                const userLat = latitude * Math.PI / 180;
                const userLon = longitude * Math.PI / 180;

                const lonDiff = kaabaLon - userLon;

                const y = Math.sin(lonDiff) * Math.cos(kaabaLat);
                const x = Math.cos(userLat) * Math.sin(kaabaLat) - Math.sin(userLat) * Math.cos(kaabaLat) * Math.cos(lonDiff);
                
                let angle = Math.atan2(y, x) * 180 / Math.PI;
                return angle;
            }
            
            function startQiblaCompass() {
                const statusDiv = document.getElementById('qiblaStatus');
                if (!('geolocation' in navigator) || !('DeviceOrientationEvent' in window)) {
                    statusDiv.innerHTML = "D√©sol√©, votre navigateur ne supporte pas les fonctionnalit√©s n√©cessaires (G√©olocalisation ou Gyroscope).";
                    return;
                }
                
                navigator.geolocation.getCurrentPosition(position => {
                    const { latitude, longitude } = position.coords;
                    qiblaAngle = calculateQiblaDirection(latitude, longitude);

                    statusDiv.innerHTML = "Veuillez orienter votre appareil. La fl√®che verte indique la Qibla.";
                    
                    deviceOrientationHandler = (event) => {
                        let alpha = event.alpha; // Compass direction (0-360)
                        if (typeof event.webkitCompassHeading !== "undefined") {
                            alpha = event.webkitCompassHeading; // for iOS
                        }
                        
                        const compassElement = document.getElementById('compass');
                        const qiblaArrow = document.getElementById('qibla-arrow');

                        if (compassElement && qiblaArrow) {
                            // Rotate the whole compass to point North
                            compassElement.style.transform = `rotate(${-alpha}deg)`;
                            // Rotate the Qibla arrow to its calculated angle relative to North
                            qiblaArrow.style.transform = `translateX(-50%) rotate(${qiblaAngle}deg)`;
                        }
                    };

                    window.addEventListener('deviceorientation', deviceOrientationHandler);
                }, error => {
                    const statusDiv = document.getElementById('qiblaStatus');
                    statusDiv.innerHTML = `Erreur de localisation: ${error.message}. Impossible de d√©terminer la direction de la Qibla.`;
                });
            }
            
            function stopQiblaCompass() {
                 if (deviceOrientationHandler) {
                    window.removeEventListener('deviceorientation', deviceOrientationHandler);
                    deviceOrientationHandler = null;
                 }
            }

            function openPopup(tool) {
                if (toolContents[tool]) {
                    popupTitle.innerText = toolContents[tool].title;
                    popupBody.innerHTML = toolContents[tool].content;
                    toolPopup.style.display = 'flex';
                    if (tool === 'prieres') {
                        document.getElementById('getPrayerTimesBtn').addEventListener('click', fetchPrayerTimes);
                    }
                    if (tool === 'qibla') {
                        startQiblaCompass();
                    }
                }
            }

            function closePopup() {
                stopQiblaCompass();
                stopPrayerCountdowns();
                toolPopup.style.display = 'none';
                popupBody.innerHTML = ''; // Clear content
            }

            function stopPrayerCountdowns() {
                if (prayerCountdownInterval) {
                    clearInterval(prayerCountdownInterval);
                    prayerCountdownInterval = null;
                }
            }

            toolCards.forEach(card => {
                card.addEventListener('click', () => {
                    openPopup(card.dataset.tool);
                });
            });

            closePopupBtn.addEventListener('click', closePopup);
            toolPopup.addEventListener('click', (event) => {
                if (event.target === toolPopup) {
                    closePopup();
                }
            });
            
            async function fetchPrayerTimes() {
                const resultsDiv = document.getElementById('prayerTimesResults');
                const legendDiv = document.getElementById('prayerTimesLegend');
                const getBtn = document.getElementById('getPrayerTimesBtn');

                if (!('geolocation' in navigator)) {
                    resultsDiv.innerHTML = '<p style="color: red;">La g√©olocalisation n\'est pas support√©e par votre navigateur.</p>';
                    return;
                }

                resultsDiv.innerHTML = '<p>Chargement des horaires...</p>';
                legendDiv.innerHTML = '';
                getBtn.disabled = true;
                getBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Localisation...';

                navigator.geolocation.getCurrentPosition(async position => {
                    const { latitude, longitude } = position.coords;

                    try {
                        const response = await fetch(`https://api.aladhan.com/v1/timings?latitude=${latitude}&longitude=${longitude}&method=2`);
                        if (!response.ok) throw new Error('Impossible de r√©cup√©rer les horaires pour votre position.');
                        const data = await response.json();
                        const timings = data.data.timings;
                        
                        stopPrayerCountdowns(); // Clear any existing interval

                        const prayerOrder = ['Fajr', 'Dhuhr', 'Asr', 'Maghrib', 'Isha'];
                        let resultsHTML = '';

                        prayerOrder.forEach(prayerName => {
                            const timeStr = timings[prayerName]; // e.g., "19:45"
                            resultsHTML += `
                                <div class="prayer-time" data-time="${timeStr}">
                                    <strong>${prayerName}</strong>
                                    <div class="time-display">${timeStr}</div>
                                    <div class="countdown"></div>
                                </div>
                            `;
                        });
                        resultsDiv.innerHTML = resultsHTML;

                        // Add legend
                        ;

                        updatePrayerCountdowns(); // Initial call
                        prayerCountdownInterval = setInterval(updatePrayerCountdowns, 1000);

                    } catch (error) {
                        resultsDiv.innerHTML = `<p style="color: red;">Erreur: ${error.message}</p>`;
                    } finally {
                         getBtn.disabled = false;
                         getBtn.innerHTML = '<i class="fas fa-crosshairs"></i> Afficher pour ma position';
                    }
                }, error => {
                     resultsDiv.innerHTML = `<p style="color: red;">Erreur de g√©olocalisation: ${error.message}.</p>`;
                     getBtn.disabled = false;
                     getBtn.innerHTML = '<i class="fas fa-crosshairs"></i> Afficher pour ma position';
                });
            }

            function updatePrayerCountdowns() {
                const now = new Date();
                let nextPrayerFoundThisCycle = false;

                document.querySelectorAll('.prayer-time').forEach(el => {
                    if (el.classList.contains('passed')) return;

                    const timeStr = el.dataset.time;
                    const [hour, minute] = timeStr.split(':');
                    const prayerTime = new Date();
                    prayerTime.setHours(parseInt(hour), parseInt(minute), 0, 0);

                    const diff = prayerTime - now;

                    if (diff < 0) {
                        el.classList.add('passed');
                        el.classList.remove('next-upcoming', 'upcoming');
                        el.querySelector('.countdown').textContent = '';
                    } else {
                        if (!nextPrayerFoundThisCycle) {
                            el.classList.add('next-upcoming');
                            el.classList.remove('upcoming');
                            nextPrayerFoundThisCycle = true;
                        } else {
                            el.classList.add('upcoming');
                            el.classList.remove('next-upcoming');
                        }

const totalSeconds = Math.floor(diff / 1000);
const hours = Math.floor(totalSeconds / 3600);
const minutes = Math.floor((totalSeconds % 3600) / 60);
const seconds = totalSeconds % 60;

el.querySelector('.countdown').textContent = ` ${hours}h ${minutes.toString().padStart(2, '0')}m ${seconds.toString().padStart(2, '0')}s`;
                    }
                });

                // If no future prayer was found, it means the last one just passed
                // we need to re-evaluate who is the "next" one (might be the one from the previous check)
                if(!nextPrayerFoundThisCycle){
                    // Find the first non-passed prayer and mark it as next.
                     const nextPrayerEl = document.querySelector('.prayer-time:not(.passed)');
                     if(nextPrayerEl){
                         nextPrayerEl.classList.add('next-upcoming');
                         nextPrayerEl.classList.remove('upcoming');
                     }
                }

            }

            async function fetchSurah(surahNumber) {
                const surahDiv = document.getElementById('surahContent');
                const transDiv = document.getElementById('surahTranslation');
                try {
                    const response = await fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}/fr.salam`);
                    if (!response.ok) throw new Error('Erreur de chargement de la sourate.');
                    const data = await response.json();
                    const ayahs = data.data.ayahs;
                    surahDiv.innerHTML = ayahs.map(a => a.text).join('<br>');
                    transDiv.innerHTML = ayahs.map(a => `${a.numberInSurah}. ${a.text}`).join('<br>');
                } catch(e) {
                    surahDiv.innerHTML = "Impossible de charger la sourate.";
                    transDiv.innerHTML = "";
                }
            }

        });
    </script>
</body>
</html>